YUI.add("itsa-mojitonthefly",function(e,t){"use strict";var n="application/json",r="pure-menu-selected",i=e.Array,s=e.Object,o="pjax",u=e.one("body"),a=e.one("head"),f=3600,l=function(e,t){e.setTime(e.getTime()+1e3*t)},c,h=e.UA,p=e.config.win,d=e.config.doc,v={},m,g=!!(p.history&&p.history.pushState&&p.history.replaceState&&("onpopstate"in p||h.gecko>=2)&&(!h.android||h.android>=2.4)),y=new RegExp("^([a-z][a-z0-9+\\-.]*:(\\/\\/[^/?#]+)?)?(\\/?[a-z0-9\\-._~%!$&'()*+,;=@]+(\\/[a-z0-9\\-._~%!$&'()*+,;=:@]+)*\\/?|\\/)([#?]|$)","i");m=e.Promise.EventNotifier=function(){this._targets=[]},m.decorate=function(e){return e._evts?e:(e._evts={subs:{},targets:[]},e.on=function(t,n){return t&&n&&(e._evts.subs[t]||(e._evts.subs[t]=[]),e._evts.subs[t].push(n)),e},e.then=function(e){return function(t,n){var r=m.decorate(e.call(this,t,n));return this._evts.targets.push(r),r}}(e.then),e)},e.mix(m.prototype,{addEvents:function(e){var t=this._targets;return t.push(e),e["catch"](function(){return!0}).then(function(){t.splice(t.indexOf(e),1)}),m.decorate(e)},fire:function(t){var n=this._targets.slice(),r={},s=arguments.length>1&&i(arguments,1,!0),o,u,a,f,l,c,h;s&&s.unshift(null,null);for(a=0;a<n.length;++a){o=n[a];if(n[a]._evts){c=e.stamp(n[a]);if(r[c])continue;r[c]=1,n.push.apply(n,n[a]._evts.targets),u=o._evts.subs[t];if(u)for(f=0,l=u.length;f<l;++f)h=u[f],s&&(s[0]=h,h=e.bind.apply(e,s)),e.soon(h)}}return this}}),e.io.xhr=function(t,n){return n=n||{},new e.Promise(function(r,i){var s=e.io(t,{method:n.method,data:n.data,headers:n.headers,form:n.form,timeout:n.timeout,on:{success:function(e,t){r(t)},failure:function(e,t){i(t)}}});this.abort=s.abort})},e.io.json=function(t,r){r=r||{},r.headers||(r.headers={}),r.headers.Accept=n;var i=e.io.xhr(t,r);return e.mix(i.then(function(t){return e.JSON.parse(t.responseText,r.reviver)}),{abort:i.abort})},e.io.getJSON=function(t,n){return n=n||{},n.method="GET",e.io.json(t,n)},c=function(t,n,r,o,f){var c=t.assets,h=c&&c.top,d=c&&c.bottom,v=h&&h.css||[],m=d&&d.css||[],g=h&&h.js||[],y=d&&d.js||[],b=h&&h.blob||[],w=d&&d.blob||[],E=p.YMojito.client,S,x,T,N,C,k,L,A,O;return k=e.Node.create(t.view),L=function(e){s.each(E._mojits,function(t,n){e.one("#"+n)&&(t.proxy._binder&&t.proxy._binder.destructor&&t.proxy._binder.destructor(),E.destroyMojitProxy(n,!1))})},C=function(){L(n),n.empty(),n.setHTML(k),i.each(w,function(e){u.append(e+"\n")}),t.binders&&E.attachBinders(t.binders),x&&x.length>0&&e.Get.load(x,{insertBefore:T})},o?C():(m.length+y.length+w.length>0&&(N=u.get("children"),T=N.item(N.size()-1)),S=f?g:v.concat(g),x=f?y:m.concat(y),i.each(b,function(e){a.append(e+"\n")}),S.length>0?e.Get.load(S,C):C()),A={viewId:k.get("id"),containerNode:n,title:t.title},r&&(O=new Date,l(O,r),A.view=t.view,A.binders=t.binders,A.expire=O),e.Promise.resolve(A)},e.Node.prototype.loadMojit=function(t,n){var r=this,i=v[t],s={"M-FLY-MOJIT":t},o,u,a,f;return n&&(s["M-FLY-ACTION"]=n),i||(s["M-FLY-FULL"]=!0),u=p.location.href.match(y),o=u[1],r._loadMojitTransaction&&r._loadMojitTransaction.abort(),f=e.io.getJSON(o,{headers:s}),r._loadMojitTransaction=a=e.mix(f.then(function(e){return v[t]=!0,c(e,r,null,i,!1)}),{abort:f.abort}),a},e.namespace("mojito").pjax=function(){var t={},n,i,a,h,v,m,b,w,E,S,x,T,N;return i=function(){var t,r;g&&(T=p.location.href.match(y),t=T[3],r=e.one('a[data-pjax-initialstate="true"]'),e.publish(o,{defaultFn:x,emitFacade:!0}),n=new e.HistoryHTML5,r&&m(t,d.title,r,!0),N=new e.Promise.EventNotifier,a(),e.later(60,null,E,t))},b=function(e,t){e.all("li").removeClass(r),t.addClass(r)},m=function(t,r,i,s){i.get("id")||i.set("id",e.guid()),s?n.replace({uri:t,targetid:i.get("id")},{url:t,title:r}):n.get("uri")===t||n.add({uri:t,targetid:i.get("id"),xpos:p.pageXOffset||d.documentElement.scrollLeft,ypos:p.pageYOffset||d.documentElement.scrollTop},{url:t,title:r})},E=function(e){u.all('a[data-pjax-preload], a[data-pjax-initialstate="true"]').each(function(t){var n=t.getAttribute("href");w(t,n,S(t,!0),n===e,!0,!0,!1)})},S=function(e,t){var n=e.getAttribute("data-pjax-preload"),r;return t?r=n==="true"?f:n:(r=e.getAttribute("data-pjax-cache")||v||n,r==="true"&&(r=f)),r},a=function(){e.on("history:change",function(t){var n=t.newVal,r=t.src==="popstate",i=n.uri,s=n.targetid,u=r&&s&&e.one("#"+s);u&&i&&e.fire(o,{uri:i,targetnode:u,fromhistorychange:!0,xpos:n.xpos,ypos:n.ypos})}),u.delegate(["tap","click"],function(t){var n=t.currentTarget;t.type==="click"?t.preventDefault():e.fire(o,{uri:n.getAttribute("href"),targetnode:n,fromhistorychange:!1})},"a[data-pjax-mojit]")},x=function(n){var r=n.uri,i=n.targetnode,s=n.fromhistorychange,o,u,a,f,h,d;s&&(i.focus(),p.scrollTo(n.xpos,n.ypos)),d=i.get("parentNode"),h=d.get("parentNode").get("parentNode"),h.hasClass("pure-menu")&&b(h,d),a=t[r],u=S(i),a?a.then(function(n){n.expire&&n.expire.getTime()>Date.now()?(N.fire("cancel",{container:n.containerNode}),f=n.expire.getTime(),t[r]=n.preload?c(n.response,n.containerNode,u,!1,!0):c({view:n.view,binders:n.binders,title:n.title},n.containerNode,u,!0,!1),t[r].expire&&t[r].expire.setTime(f),s||m(r,n.title,i)):e.one("#"+n.viewId)?(N.fire("cancel",{container:n.containerNode}),o=p.YMojito.client._mojits[n.viewId],o&&o.proxy.refreshView(),n.expire&&(n.expire=new Date,l(n.expire,u)),s||m(r,n.title,i)):w(i,r,u,n.preload?!1:!0,!1,s,n.preload)},function(){w(i,r,u,!1,!1,s)}):w(i,r,u,!1,!1,s)},w=function(n,r,i,s,o,a,f){var p=n.getAttribute("data-pjax-container"),v=p&&e.one(p)||h||u,g=0,y,b,w,E,S;y=n.getAttribute("data-pjax-mojit"),b=n.getAttribute("data-pjax-action"),w={"M-PJAX":!0};while(S=n.getAttribute("data-pjax-par"+ ++g))w["M-PJAX-PAR"+g]=S;y&&(w["M-PJAX-MOJIT"]=y),b&&(w["M-PJAX-ACTION"]=b),s||(w["M-PJAX-FULL"]=!0),o||N.fire("cancel",{container:v}),E=e.io.getJSON(r,{headers:w}),a||m(r,d.title,n),E.then(function(h){var p,d,g,y,b,w,E;a||m(r,h.title,n,!0),o?(g=h.assets,y=g&&g.top&&g.top.css||[],b=g&&g.bottom&&g.bottom.css||[],y.length>0&&e.Get.load(y),b.length>0&&(w=u.get("children"),E=w.item(w.size()-1),e.Get.load(b,{insertBefore
:E})),d={response:h,containerNode:v,preload:!0},i&&(p=new Date,l(p,i),d.expire=p),t[r]=e.Promise.resolve(d)):t[r]=c(h,v,i,s,f)}),E.preload=o,E.container=v,N.addEvents(E),E.on("cancel",function(e){var t=E;t.preload||t.container!==e.container||t.abort()})},i(),{setContainer:function(e){h=e},setCacheTime:function(e){typeof e=="number"&&(v=e)},emptyCache:function(){var e=Date.now()-1;s.each(t,function(t){var n=t;n.then(function(t){t.expire=e})})},pjaxAvailable:function(){return g},simulateAnchorClick:function(t){var n=t.get("tagName")==="A"&&t.getAttribute("data-pjax-mojit");n&&e.fire(o,{uri:t.getAttribute("href"),targetnode:t,fromhistorychange:!1})}}}()},"@VERSION@",{requires:["node-base","promise","node-event-delegate","history-html5","event-tap","get","io-base","json-parse"]});