YUI.add("itsa-mojitonthefly",function(e,t){"use strict";var n="application/json",r="pure-menu-selected",i=e.Array,s=e.Object,o="pjax",u=e.one("body"),a=e.one("head"),f=3600,l=function(e,t){e.setTime(e.getTime()+1e3*t)},c,h=e.UA,p=e.config.win,d=e.config.doc,v={},m,g=!!(p.history&&p.history.pushState&&p.history.replaceState&&("onpopstate"in p||h.gecko>=2)&&(!h.android||h.android>=2.4)),y=new RegExp("^([a-z][a-z0-9+\\-.]*:(\\/\\/[^/?#]+)?)?(\\/?[a-z0-9\\-._~%!$&'()*+,;=@]+(\\/[a-z0-9\\-._~%!$&'()*+,;=:@]+)*\\/?|\\/)([#?]|$)","i");m=e.Promise.EventNotifier=function(){this._targets=[]},m.decorate=function(e){return e._evts?e:(e._evts={subs:{},targets:[]},e.on=function(t,n){return t&&n&&(e._evts.subs[t]||(e._evts.subs[t]=[]),e._evts.subs[t].push(n)),e},e.then=function(e){return function(t,n){var r=m.decorate(e.call(this,t,n));return this._evts.targets.push(r),r}}(e.then),e)},e.mix(m.prototype,{addEvents:function(e){var t=this._targets;return t.push(e),e["catch"](function(){return!0}).then(function(){t.splice(t.indexOf(e),1)}),m.decorate(e)},fire:function(t){var n=this._targets.slice(),r={},s=arguments.length>1&&i(arguments,1,!0),o,u,a,f,l,c,h;s&&s.unshift(null,null);for(a=0;a<n.length;++a){o=n[a];if(n[a]._evts){c=e.stamp(n[a]);if(r[c])continue;r[c]=1,n.push.apply(n,n[a]._evts.targets),u=o._evts.subs[t];if(u)for(f=0,l=u.length;f<l;++f)h=u[f],s&&(s[0]=h,h=e.bind.apply(e,s)),e.soon(h)}}return this}}),e.io.xhr=function(t,n){return n=n||{},new e.Promise(function(r,i){var s=e.io(t,{method:n.method,data:n.data,headers:n.headers,form:n.form,timeout:n.timeout,on:{success:function(e,t){r(t)},failure:function(e,t){i(t)}}});this.abort=s.abort})},e.io.json=function(t,r){r=r||{},r.headers||(r.headers={}),r.headers.Accept=n;var i=e.io.xhr(t,r);return e.mix(i.then(function(t){return e.JSON.parse(t.responseText,r.reviver)}),{abort:i.abort})},e.io.getJSON=function(t,n){return n=n||{},n.method="GET",e.io.json(t,n)},c=function(t,n,r,o,f){var c=t.assets,h=c&&c.top,d=c&&c.bottom,v=h&&h.css||[],m=d&&d.css||[],g=h&&h.js||[],y=d&&d.js||[],b=h&&h.blob||[],w=d&&d.blob||[],E=p.YMojito.client,S,x,T,N,C,k,L,A,O;return k=e.Node.create(t.view),L=function(e){s.each(E._mojits,function(t,n){e.one("#"+n)&&(t.proxy._binder&&t.proxy._binder.destructor&&t.proxy._binder.destructor(),E.destroyMojitProxy(n,!1))})},C=function(){L(n),n.empty(),n.setHTML(k),i.each(w,function(e){u.append(e+"\n")}),t.binders&&E.attachBinders(t.binders),x&&x.length>0&&e.Get.load(x,{insertBefore:T})},o?C():(m.length+y.length+w.length>0&&(N=u.get("children"),T=N.item(N.size()-1)),S=f?g:v.concat(g),x=f?y:m.concat(y),i.each(b,function(e){a.append(e+"\n")}),S.length>0?e.Get.load(S,C):C()),A={viewId:k.get("id"),containerNode:n,title:t.title},r&&(O=new Date,l(O,r),A.view=t.view,A.binders=t.binders,A.expire=O),e.Promise.resolve(A)},e.Node.prototype.loadMojit=function(t,n){var r=this,i=v[t],s={"M-FLY-MOJIT":t},o,u,a,f;return n&&(s["M-FLY-ACTION"]=n),i||(s["M-FLY-FULL"]=!0),u=p.location.href.match(y),o=u[1],r._loadMojitTransaction&&r._loadMojitTransaction.abort(),f=e.io.getJSON(o,{headers:s}),r._loadMojitTransaction=a=e.mix(f.then(function(e){return v[t]=!0,c(e,r,null,i,!1)}),{abort:f.abort}),a},e.namespace("mojito").pjax=function(){var t={},n,i,a,h,v,m,b,w,E,S,x,T,N,C;return i=function(){var t;g&&(N=p.location.href.match(y),t=N[3]||"",t[0]==="/"||(t="/"+t),e.publish(o,{defaultFn:T,emitFacade:!0}),b(t),C=new e.Promise.EventNotifier,a(),e.later(60,null,S,t))},b=function(t){var r={},i,s,o,u,a;i=e.one('a[data-pjax-initialstate="true"]');if(i){u=i.get("id"),r={"data-pjax-mojit":i.getAttribute("data-pjax-mojit"),"data-pjax-action":i.getAttribute("data-pjax-action"),"data-pjax-container":i.getAttribute("data-pjax-container"),"data-pjax-preload":i.getAttribute("data-pjax-preload")},s=0;while(o=i.getAttribute("data-pjax-par"+ ++s))r["data-pjax-par"+s]=o;a={uri:t,targetid:u,attributes:r}}n=new e.HistoryHTML5,i&&m(t,e.config.doc.title,u,r,!0)},w=function(e,t){e.all("li").removeClass(r),t.addClass(r)},m=function(e,t,r,i,s){s?n.replace({uri:e,targetid:r,attributes:i},{url:e,title:t}):n.get("uri")===e||n.add({uri:e,targetid:r,attributes:i,xpos:p.pageXOffset||d.documentElement.scrollLeft,ypos:p.pageYOffset||d.documentElement.scrollTop},{url:e,title:t})},S=function(e){u.all('a[data-pjax-preload], a[data-pjax-initialstate="true"]').each(function(t){var n=t.getAttribute("href"),r,i,s;i={"data-pjax-mojit":t.getAttribute("data-pjax-mojit"),"data-pjax-action":t.getAttribute("data-pjax-action"),"data-pjax-container":t.getAttribute("data-pjax-container"),"data-pjax-preload":t.getAttribute("data-pjax-preload")},r=0;while(s=t.getAttribute("data-pjax-par"+ ++r))i["data-pjax-par"+r]=s;E(t.get("id"),i,n,x(t.getAttribute("data-pjax-preload"),!0),n===e,!0,!0,!1)})},x=function(e,t){var n;return t?n=e==="true"?f:e:(n=e||v||e,n==="true"&&(n=f)),n},a=function(){e.on("history:change",function(t){var n=t.newVal,r=t.src==="popstate",i=n.uri,s=n.targetid,u=n.attributes;i===""&&(i="/"),r&&i&&e.fire(o,{uri:i,targetid:s,attributes:u,fromhistorychange:!0,xpos:n.xpos,ypos:n.ypos})}),u.delegate(["tap","click"],function(t){var n=t.currentTarget,r,i,s;if(t.type==="click")t.preventDefault();else{r={"data-pjax-mojit":n.getAttribute("data-pjax-mojit"),"data-pjax-action":n.getAttribute("data-pjax-action"),"data-pjax-container":n.getAttribute("data-pjax-container"),"data-pjax-preload":n.getAttribute("data-pjax-preload")},s=0;while(i=n.getAttribute("data-pjax-par"+ ++s))r["data-pjax-par"+s]=i;e.fire(o,{uri:n.getAttribute("href"),targetid:n.get("id"),attributes:r,fromhistorychange:!1})}},"a[data-pjax-mojit]")},T=function(n){var r=n.uri,i=n.targetid,s=n.attributes,o=n.fromhistorychange,u,a,f,h,d,v,g,y;y=function(){g=e.one("#"+i),o&&(g&&g.focus(),p.scrollTo(n.xpos,n.ypos)),v=g&&g.get("parentNode"),d=v&&v.get("parentNode").get("parentNode"),d&&d.hasClass("pure-menu")&&w(d,v)},f=t[r],a=x(s["data-pjax-preload"]),f?f.then(function(n){n.expire&&n.expire.getTime()>Date.now()?(C.fire("cancel",{container:n.containerNode}),h=n.expire
.getTime(),t[r]=n.preload?c(n.response,n.containerNode,a,!1,!0):c({view:n.view,binders:n.binders,title:n.title},n.containerNode,a,!0,!1),t[r].expire&&t[r].expire.setTime(h),o||m(r,n.title,i,s)):e.one("#"+n.viewId)?(C.fire("cancel",{container:n.containerNode}),u=p.YMojito.client._mojits[n.viewId],u&&u.proxy.refreshView(),n.expire&&(n.expire=new Date,l(n.expire,a)),o||m(r,n.title,i,s)):E(i,s,r,a,n.preload?!1:!0,!1,o,n.preload)},function(){E(i,s,r,a,!1,!1,o)}).then(y,y):E(i,s,r,a,!1,!1,o).then(y,y)},E=function(n,r,i,s,o,a,f,p){var v=r["data-pjax-container"],g=v&&e.one(v)||h||u,y=0,b,w,E,S,x;b=r["data-pjax-mojit"],w=r["data-pjax-action"],E={"M-PJAX":!0};while(x=r["data-pjax-par"+ ++y])E["M-PJAX-PAR"+y]=x;return b&&(E["M-PJAX-MOJIT"]=b),w&&(E["M-PJAX-ACTION"]=w),o||(E["M-PJAX-FULL"]=!0),a||C.fire("cancel",{container:g}),S=e.io.getJSON(i,{headers:E}),f||m(i,d.title,n,r),S.preload=a,S.container=g,C.addEvents(S),S.on("cancel",function(e){var t=S;t.preload||t.container!==e.container||t.abort()}),S.then(function(h){var d,v,y,b,w,E,S;f||m(i,h.title,n,r,!0),a?(y=h.assets,b=y&&y.top&&y.top.css||[],w=y&&y.bottom&&y.bottom.css||[],b.length>0&&e.Get.load(b),w.length>0&&(E=u.get("children"),S=E.item(E.size()-1),e.Get.load(w,{insertBefore:S})),v={response:h,containerNode:g,preload:!0},s&&(d=new Date,l(d,s),v.expire=d),t[i]=e.Promise.resolve(v)):t[i]=c(h,g,s,o,p)})},i(),{setContainer:function(e){h=e},setCacheTime:function(e){typeof e=="number"&&(v=e)},emptyCache:function(){var e=Date.now()-1;s.each(t,function(t){var n=t;n.then(function(t){t.expire=e})})},pjaxAvailable:function(){return g},simulateAnchorClick:function(t){var n=t.get("tagName")==="A"&&t.getAttribute("data-pjax-mojit"),r,i,s;if(n){r={"data-pjax-mojit":t.getAttribute("data-pjax-mojit"),"data-pjax-action":t.getAttribute("data-pjax-action"),"data-pjax-container":t.getAttribute("data-pjax-container"),"data-pjax-preload":t.getAttribute("data-pjax-preload")},i=0;while(s=t.getAttribute("data-pjax-par"+ ++i))r["data-pjax-par"+i]=s;e.fire(o,{uri:t.getAttribute("href"),targetid:t.get("id"),attributes:r,fromhistorychange:!1})}}}}()},"@VERSION@",{requires:["node-base","promise","node-event-delegate","history-html5","event-tap","get","io-base","json-parse"]});